<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‚°ì±… ì¹œêµ¬ ì°¾ê¸° (ì§€ë„)</title>
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #map { width: 100%; height: 50vh; } /* ì§€ë„ë¥¼ í™”ë©´ ì ˆë°˜ ì°¨ì§€í•˜ê²Œ */
        .container { padding: 20px; background-color: #f9f9f9; height: 50vh; overflow-y: auto; }
        .card {
            background: white; padding: 15px; margin-bottom: 10px;
            border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 5px solid #4CAF50; cursor: pointer;
        }
        .card:hover { background-color: #f0f8f0; }
        .score { float: right; font-weight: bold; color: #e91e63; }
    </style>
    
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=407503af1dc64fb186371b96a0168a25"></script>
</head>
<body>

    <div id="map"></div>

    <div class="container">
        <h2>ğŸ“ ë‚´ ì£¼ë³€ ì¶”ì²œ ì¹œêµ¬</h2>
        <div id="list-area">ë¡œë”© ì¤‘...</div>
    </div>

    <script>
        var map;
        var markers = [];

        window.onload = async function() {
            // 1. ì§€ë„ ìƒì„± (ì´ˆê¸° ìœ„ì¹˜: ê°•ë‚¨ì—­)
            var container = document.getElementById('map');
            var options = { center: new kakao.maps.LatLng(37.4979, 127.0276), level: 5 };
            map = new kakao.maps.Map(container, options);

            // ë‚´ ìœ„ì¹˜ ë§ˆì»¤ (ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œí•˜ê³  ì‹¶ì§€ë§Œ ê¸°ë³¸ ë§ˆì»¤ ì‚¬ìš©)
            var myMarker = new kakao.maps.Marker({ position: new kakao.maps.LatLng(37.4979, 127.0276) });
            myMarker.setMap(map);

            // 2. ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const myId = 1; 
            const lat = 37.4979; 
            const lon = 127.0276;

            try {
                const response = await fetch(`/api/walkers/recommend?myId=${myId}&lat=${lat}&lon=${lon}`);
                const data = await response.json();

                const listArea = document.getElementById('list-area');
                listArea.innerHTML = '';

                data.forEach(walker => {
                    // 3. ë¦¬ìŠ¤íŠ¸ ì¶”ê°€
                    const html = `
                        <div class="card" onclick="moveTo(${walker.latitude}, ${walker.longitude})">
                            <span class="score">${walker.matchScore}ì </span>
                            <h3>ğŸ¶ ${walker.name} <small>(${walker.dogSize})</small></h3>
                            <div>ê±°ë¦¬: ${walker.distanceMeters}m</div>
                        </div>
                    `;
                    listArea.innerHTML += html;

                    // 4. ì§€ë„ì— ë§ˆì»¤ ì°ê¸°
                    var markerPosition  = new kakao.maps.LatLng(walker.latitude, walker.longitude); 
                    var marker = new kakao.maps.Marker({ position: markerPosition });
                    marker.setMap(map);

                    // ë§ˆì»¤ì— ì´ë¦„ í‘œì‹œ (ì¸í¬ìœˆë„ìš°)
                    var iwContent = `<div style="padding:5px;">${walker.name} <br><small>${walker.matchScore}ì </small></div>`;
                    var infowindow = new kakao.maps.InfoWindow({ position : markerPosition, content : iwContent });
                    infowindow.open(map, marker);
                });

            } catch (e) {
                console.error(e);
                alert("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨ (API í‚¤ë¥¼ í™•ì¸í–ˆë‚˜ìš”?)");
            }
        };

        // ë¦¬ìŠ¤íŠ¸ í´ë¦­ ì‹œ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì§€ë„ ì´ë™
        function moveTo(lat, lon) {
            var moveLatLon = new kakao.maps.LatLng(lat, lon);
            map.panTo(moveLatLon);
        }
    </script>
</body>
</html>